<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Turbo Gravity | Dashboard</title>
  <link rel="stylesheet" href="/public/styles.css" />
</head>
<body>
  <div class="backdrop"></div>
  <header class="topbar">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <h1>Turbo Gravity</h1>
        <p>Control Panel</p>
      </div>
    </div>
    <div class="topbar-actions">
      <button id="theme-toggle" aria-label="Toggle theme">üåô</button>
      <a class="button ghost" href="/control/invite">Invite</a>
      <a class="button ghost" href="/logout">Logout</a>
      <div class="user-chip">
        <span><%= user.username %></span>
        <span class="pill">Admin</span>
      </div>
    </div>
  </header>

  <main class="page">
    <section class="hero">
      <div>
        <p class="eyebrow">Bot Status</p>
        <h2>Discord Control Center</h2>
        <p class="muted">Manage lifecycle, presence, and runtime settings without restarting the dashboard.</p>
        <div class="hero-actions">
          <span class="status-chip <%= botStatus %>"><span class="pulse"></span><%= botStatus %></span>
          <a class="button primary" href="/control/invite">Add to Server</a>
        </div>
      </div>
      <div class="hero-card">
        <p class="eyebrow">Quick Actions</p>
        <div class="actions">
          <form method="POST" action="/control/start"><button class="button success" type="submit">Start</button></form>
          <form method="POST" action="/control/stop"><button class="button danger" type="submit">Stop</button></form>
          <form method="POST" action="/control/restart"><button class="button" type="submit">Restart</button></form>
        </div>
      </div>
    </section>

    <section class="grid two">
      <div class="card">
        <div class="card-header">
          <div>
            <p class="eyebrow">Presence</p>
            <h3>Update Status</h3>
          </div>
        </div>
        <form class="form" method="POST" action="/control/status">
          <label>Activity Type
            <select name="activityType">
              <option value="0">Playing</option>
              <option value="2">Listening</option>
              <option value="3">Watching</option>
              <option value="5">Competing</option>
            </select>
          </label>
          <label>Status Text
            <input type="text" name="statusText" placeholder="Playing with APIs" required />
          </label>
          <button class="button primary" type="submit">Save</button>
        </form>
      </div>

      <div class="card">
        <div class="card-header">
          <div>
            <p class="eyebrow">Runtime</p>
            <h3>Configuration</h3>
          </div>
        </div>
        <form class="form" method="POST" action="/control/config">
          <label class="checkbox">
            <input type="checkbox" name="autoStart" <%= config?.autoStart ? 'checked' : '' %> />
            <span>Auto-start bot on boot</span>
          </label>

          <div class="dual">
            <label>Presence Type
              <select name="presenceType" value="<%= config?.presenceType ?? 0 %>">
                <option value="0" <%= config?.presenceType === 0 ? 'selected' : '' %>>Playing</option>
                <option value="2" <%= config?.presenceType === 2 ? 'selected' : '' %>>Listening</option>
                <option value="3" <%= config?.presenceType === 3 ? 'selected' : '' %>>Watching</option>
                <option value="5" <%= config?.presenceType === 5 ? 'selected' : '' %>>Competing</option>
              </select>
            </label>
            <label>Command Scope
              <select name="commandScope">
                <option value="guild" <%= config?.commandScope !== 'global' ? 'selected' : '' %>>Guild</option>
                <option value="global" <%= config?.commandScope === 'global' ? 'selected' : '' %>>Global</option>
              </select>
            </label>
          </div>

          <label>Presence Text
            <input type="text" name="presenceText" value="<%= config?.presenceText || '' %>" placeholder="Ready to serve" />
          </label>

          <label>Guild ID (for guild scope)
            <input type="text" name="guildId" value="<%= config?.guildId || '' %>" placeholder="1234567890" />
          </label>

          <label>Invite Permissions
            <input type="text" name="invitePermissions" value="<%= config?.invitePermissions || '8' %>" />
          </label>

          <div class="dual">
            <label>Bot Token (write-only)
              <input type="password" name="botToken" placeholder="Update token" />
            </label>
            <label>Client ID (write-only)
              <input type="password" name="clientId" placeholder="Update client ID" />
            </label>
          </div>

          <div class="dual">
            <label>Client Secret (write-only)
              <input type="password" name="clientSecret" placeholder="Update client secret" />
            </label>
            <label>Callback URL
              <input type="url" name="callbackUrl" value="<%= config?.callbackUrl || '' %>" placeholder="http://localhost:3000/auth/discord/callback" />
            </label>
          </div>

          <button class="button primary" type="submit">Save Configuration</button>
        </form>
      </div>
    </section>
  </main>

  <script>
    const toggle = document.getElementById('theme-toggle');
    const root = document.documentElement;
    const stored = localStorage.getItem('theme');
    if (stored === 'light') root.classList.remove('dark');
    toggle.addEventListener('click', () => {
      const isDark = root.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      toggle.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
    });
  </script>
</body>
</html>
